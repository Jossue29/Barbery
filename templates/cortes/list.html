{% extends 'base.html' %}
{% load l10n %}
{% block title %}Cat√°logo de Cortes{% endblock %}

{% block content %}
{% if request.user.is_staff %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="mb-0">üíà Cat√°logo de Cortes</h2>
  <button class="btn btn-primary" data-coreui-toggle="modal" data-coreui-target="#modalCorte">
    ‚ûï Nuevo Corte
  </button>
</div>
{% endif %}

<div class="row">
  {% for corte in cortes %}
    <div class="col-md-4 mb-4">
      <div class="card h-100 shadow-sm">
        <div class="card-body">
          <h5 class="card-title">{{ corte.nombre_corte }}</h5>
          {% if corte.descripcion %}
            <p class="card-text text-muted">{{ corte.descripcion }}</p>
          {% else %}
            <p class="text-muted fst-italic">Sin descripci√≥n</p>
          {% endif %}
        </div>

        <div class="card-footer d-flex justify-content-between align-items-center">
          <strong class="text-success">C$ {{ corte.precio|floatformat:2 }}</strong>

          {% if request.user.is_staff %}
            <!-- Bot√≥n de editar -->
            <button class="btn btn-sm btn-primary" 
                    data-coreui-toggle="modal" 
                    data-coreui-target="#editarCorteModal{{ corte.id }}">
              Editar
            </button>
          {% endif %}
        </div>
      </div>
    </div>

    {% if request.user.is_staff %}
    <!-- Modal de edici√≥n (uno por cada corte) -->
    <div class="modal fade" id="editarCorteModal{{ corte.id }}" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <form method="POST" action="{% url 'editar_corte' corte_id=corte.id %}">
            {% csrf_token %}
            <div class="modal-header">
              <h5 class="modal-title">Editar Corte</h5>
              <button type="button" class="btn-close" data-coreui-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label class="form-label">Nombre del corte</label>
                <input type="text" name="nombre_corte" class="form-control" value="{{ corte.nombre_corte }}" required>
              </div>
              <div class="mb-3">
                <label class="form-label">Descripci√≥n</label>
                <textarea name="descripcion" class="form-control" rows="3">{{ corte.descripcion }}</textarea>
              </div>
              <div class="mb-3">
                <label class="form-label">Precio (C$)</label>
                <input type="number" name="precio" class="form-control" value="{{ corte.precio }}" required>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-coreui-dismiss="modal">Cancelar</button>
              <button type="submit" class="btn btn-success">Guardar cambios</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    {% endif %}

  {% empty %}
    <p>No hay cortes registrados.</p>
  {% endfor %}
</div>

<!-- Modal de creaci√≥n -->
{% if request.user.is_staff %}
<div class="modal fade" id="modalCorte" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <form method="post">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title">Nuevo Corte</h5>
          <button type="button" class="btn-close" data-coreui-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Nombre del corte</label>
            <input type="text" name="nombre_corte" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Descripci√≥n</label>
            <textarea name="descripcion" class="form-control" rows="3"></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">Precio (C$)</label>
            <input type="number" step="0.01" name="precio" class="form-control" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-coreui-dismiss="modal">Cancelar</button>
          <button type="submit" class="btn btn-success">Guardar</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endif %}

{% endblock %}
